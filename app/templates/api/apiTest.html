{% extends "shared/layout.html" %}
{% set active_page = "api_test" %}

{% block title %}API Generator - API Test{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/testApi.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/lib/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/lib/languages/json.min.js"></script>
{% endblock %}

{% block content %}
{% with 
    title='API Test Console',
    breadcrumb_items=[
        {'url': url_for('main.index'), 'text': 'Home'},
        {'text': 'API Test'}
    ]
%}
    {% include 'shared/partials/page_header.html' %}
{% endwith %}

<section class="section">
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">API Configuration</h5>
                    <form id="apiTestForm">
                        <div class="mb-3">
                            <label for="apiSelect" class="form-label">Select API</label>
                            <select class="form-select" id="apiSelect" name="apiName" required>
                                <option value="">-- Select an API --</option>
                                {% if key %}
                                <option value="{{ key }}" selected>{{ key }}</option>
                                {% endif %}
                            </select>
                        </div>
                        
                        <div id="parameters-container">
                            {% if api_config and api_config.get('parameters') %}
                                {% for param_name, param_info in api_config.get('parameters', {}).items() %}
                                <div class="mb-3">
                                    <label for="param-{{ param_name }}" class="form-label">{{ param_name }}</label>
                                    <input type="text" class="form-control" id="param-{{ param_name }}" 
                                           name="{{ param_name }}" placeholder="{{ param_info.get('description', '') }}">
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-lightning-charge"></i> Execute API
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">API Information</h5>
                    <div id="apiInfo">
                        {% if api_config %}
                        <div class="api-details">
                            <p><strong>API:</strong> {{ key }}</p>
                            <p><strong>Description:</strong> {{ api_config.get('description', 'No description available') }}</p>
                            <p><strong>Database:</strong> {{ api_config.get('database', {}).get('type', 'Not specified') }}</p>
                            <p><strong>Table:</strong> {{ api_config.get('database', {}).get('table', 'Not specified') }}</p>
                        </div>
                        {% else %}
                        <div class="alert alert-info">
                            Select an API to view its information
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">API Response</h5>
                    <div class="response-container">
                        <div class="response-tabs">
                            <button class="tab-button active" data-target="result-tab">Result</button>
                            <button class="tab-button" data-target="query-tab">Query</button>
                        </div>
                        <div class="response-content">
                            <div id="result-tab" class="tab-content active">
                                <pre><code class="json" id="apiResponse">// API response will appear here</code></pre>
                            </div>
                            <div id="query-tab" class="tab-content">
                                <pre><code class="json" id="apiQuery">// Query will appear here</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/api-test.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        hljs.highlightAll();
    });
</script>
{% endblock %}