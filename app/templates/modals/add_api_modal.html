<!-- Add API Modal -->
<div class="modal fade" id="addApiModal" tabindex="-1" aria-labelledby="addApiModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addApiModalLabel">Add New API</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addApiForm">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs mb-3" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="add-general-tab" data-bs-toggle="tab" data-bs-target="#add-general" type="button" role="tab" aria-controls="add-general" aria-selected="true">General</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="add-database-tab" data-bs-toggle="tab" data-bs-target="#add-database" type="button" role="tab" aria-controls="add-database" aria-selected="false">Database</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="add-pagination-tab" data-bs-toggle="tab" data-bs-target="#add-pagination" type="button" role="tab" aria-controls="add-pagination" aria-selected="false">Pagination & Ordering</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="add-cache-tab" data-bs-toggle="tab" data-bs-target="#add-cache" type="button" role="tab" aria-controls="add-cache" aria-selected="false">Cache</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="add-response-tab" data-bs-toggle="tab" data-bs-target="#add-response" type="button" role="tab" aria-controls="add-response" aria-selected="false">Response</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="add-conditions-tab" data-bs-toggle="tab" data-bs-target="#add-conditions" type="button" role="tab" aria-controls="add-conditions" aria-selected="false">API Conditions</button>
                        </li>
                    </ul>
                    
                    <!-- Tab content -->
                    <div class="tab-content">
                        <!-- General Tab -->
                        <div class="tab-pane fade show active" id="add-general" role="tabpanel" aria-labelledby="add-general-tab">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="addApiId" class="form-label">API ID</label>
                                    <input type="text" class="form-control" id="addApiId" name="id" placeholder="Unique API identifier (e.g. API_CUS_Customer)" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="addApiName" class="form-label">Display Name</label>
                                    <input type="text" class="form-control" id="addApiName" name="name" placeholder="User-friendly API name">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="addApiVersion" class="form-label">Version</label>
                                    <input type="text" class="form-control" id="addApiVersion" name="version" placeholder="1.0.0">
                                </div>
                                <div class="col-md-6">
                                    <label for="addApiTags" class="form-label">Tags</label>
                                    <input type="text" class="form-control" id="addApiTags" name="tags" placeholder="Comma-separated tags">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="addApiDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="addApiDescription" name="description" rows="3" placeholder="Description of the API"></textarea>
                            </div>
                        </div>
                        
                        <!-- Database Tab -->
                        <div class="tab-pane fade" id="add-database" role="tabpanel" aria-labelledby="add-database-tab">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="addDatabaseType" class="form-label">Database Type <span class="text-danger">*</span></label>
                                    <select class="form-select" id="addDatabaseType" name="database_type" required>
                                        <option value="">Select Database Type</option>
                                        {% if db_types %}
                                            {% for db_key, db_info in db_types.items() %}
                                                <option value="{{ db_key }}" {% if db_config and db_key == db_config.get('db_type') %}selected{% endif %}>
                                                    {{ db_info.name }} {% if db_config and db_key == db_config.get('db_type') %}(Active){% endif %}
                                                </option>
                                            {% endfor %}
                                        {% else %}
                                            <option value="mongodb">MongoDB</option>
                                            <option value="mysql">MySQL</option>
                                            <option value="postgresql">PostgreSQL</option>
                                            <option value="sqlite">SQLite</option>
                                            <option value="mssql">SQL Server</option>
                                            <option value="oracle">Oracle</option>
                                            <option value="trino">Trino</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="addDatabaseName" class="form-label">Database Name <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="addDatabaseName" name="database_name" placeholder="Database name" required>
                                        <button class="btn btn-outline-primary" type="button" onclick="loadDatabaseTables(document.getElementById('addDatabaseType').value, 'addTable', 'addLastUpdateTable')">
                                            <i class="bi bi-arrow-repeat"></i> Load Tables
                                        </button>
                                    </div>
                                    <small class="form-text text-muted">Enter database name and click Load Tables</small>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="addTable" class="form-label">Table/Collection <span class="text-danger">*</span></label>
                                    <select class="form-select" id="addTable" name="table" required>
                                        <option value="">Select Table/Collection</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="addLastUpdateTable" class="form-label">Last Update Table (optional)</label>
                                    <select class="form-select" id="addLastUpdateTable" name="last_update_table">
                                        <option value="">Select Last Update Table</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pagination & Ordering Tab -->
                        <div class="tab-pane fade" id="add-pagination" role="tabpanel" aria-labelledby="add-pagination-tab">
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="addEnablePagination" name="enable_pagination" checked>
                                    <label class="form-check-label" for="addEnablePagination">Enable Pagination</label>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="addDefaultLimit" class="form-label">Default Limit</label>
                                    <input type="number" class="form-control" id="addDefaultLimit" name="default_limit" value="10" min="1">
                                </div>
                                <div class="col-md-6">
                                    <label for="addMaxLimit" class="form-label">Maximum Limit</label>
                                    <input type="number" class="form-control" id="addMaxLimit" name="max_limit" value="100" min="1">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="addDefaultOrderField" class="form-label">Default Order Field</label>
                                    <select class="form-select column-select" id="addDefaultOrderField" name="default_order_field">
                                        <option value="">Select Field</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="addDefaultOrderDirection" class="form-label">Default Order Direction</label>
                                    <select class="form-select" id="addDefaultOrderDirection" name="default_order_direction">
                                        <option value="ASC">Ascending</option>
                                        <option value="DESC">Descending</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cache Tab -->
                        <div class="tab-pane fade" id="add-cache" role="tabpanel" aria-labelledby="add-cache-tab">
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="addEnableCache" name="enable_cache">
                                    <label class="form-check-label" for="addEnableCache">Enable Caching</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="addCacheTTL" class="form-label">Cache TTL (seconds)</label>
                                <input type="number" class="form-control" id="addCacheTTL" name="cache_ttl" value="60" min="1">
                            </div>
                        </div>
                        
                        <!-- Response Tab -->
                        <div class="tab-pane fade" id="add-response" role="tabpanel" aria-labelledby="add-response-tab">
                            <div class="mb-3">
                                <label for="addResponseFields" class="form-label">Response Fields</label>
                                <select class="form-select column-select" id="addResponseFields" name="response_fields" multiple size="10">
                                    <!-- Populated dynamically -->
                                </select>
                                <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple fields</small>
                            </div>
                        </div>
                        
                        <!-- API Conditions Tab -->
                        <div class="tab-pane fade" id="add-conditions" role="tabpanel" aria-labelledby="add-conditions-tab">
                            <div class="mb-3">
                                <h5>API Conditions</h5>
                                <table class="table table-sm table-striped">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Display Name</th>
                                            <th>Column</th>
                                            <th>Operator</th>
                                            <th>Data Type</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="addConditionsTableBody">
                                        <!-- Conditions will be added here -->
                                    </tbody>
                                </table>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addNewConditionBtn">
                                    <i class="bi bi-plus"></i> Add Condition
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="createApiBtn">Create API</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="deleteConfirmMessage">Are you sure you want to delete this item?</p>
                <!-- Hidden fields to store context -->
                <input type="hidden" id="deleteType" value="">
                <input type="hidden" id="deleteIndex" value="">
                <input type="hidden" id="deleteApiId" value="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>
